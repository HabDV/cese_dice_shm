<% CASE '/free_bonus' %>
{{ TEXT = BLOCK }}
üéÅ –î–ª—è –Ω–∞—à–∏—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ –¥–æ—Å—Ç—É–ø–Ω—ã —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–µ –∞–∫—Ü–∏–∏!

–¢–µ–ø–µ—Ä—å –∫–∞–∂–¥—ã–π –¥–µ–Ω—å —É –í–∞—Å –µ—Å—Ç—å —à–∞–Ω—Å –∏—Å–ø—ã—Ç–∞—Ç—å —É–¥–∞—á—É –≤ —Å–ª–æ—Ç–∞—Ö Telegram –∏ –¥–æ–±–∞–≤–∏—Ç—å –±–æ–Ω—É—Å–Ω—ã–µ —Ä—É–±–ª–∏ –Ω–∞ —Å–≤–æ–π –±–∞–ª–∞–Ω—Å!

<b>–ì–æ—Ç–æ–≤—ã –∏—Å–ø—ã—Ç–∞—Ç—å —Å—É–¥—å–±—É?</b> –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ üëá
{{ END }}
{{ buttons = [] }}
{{ buttons.push([
    {
        text = 'üé∞ –ò—Å–ø—ã—Ç–∞–π –£–¥–∞—á—É!'
        callback_data = '/dice'
    }
]) }}
{{ tg_api(sendMessage = {
    text = TEXT
    parse_mode = "HTML"
    reply_markup = {
        inline_keyboard = buttons
    }
}) }}

<% CASE [ '/dice' ]%>
{{ vpn_mz_active = user.us.filter( category = 'vpn-mz', status = 'ACTIVE' ).items }}
{{ USE date }}
{{ SET spin_time = storage.read('name','result_' _ user.id ).0.result.date }}
{{ SET time_now = date.now }}
{{ SET true_time = spin_time + 86400 }}
{{ SET wait_seconds = true_time - time_now }}

{{ PERL }}
  my $seconds = $stash->get('wait_seconds');
  my $hours = int($seconds / 3600);
  my $minutes = int(($seconds % 3600) / 60);
  $stash->set('wait_hours', $hours);
  $stash->set('wait_minutes', $minutes);
{{ END }}

{{ IF vpn_mz_active.size > 0 }}
{{ tg_api( "answerCallbackQuery" = {
         "show_alert" = "true"
         "callback_query_id" = callback_query.id        
         "text" = "‚ö°Ô∏è –£—Å–ø–µ–π—Ç–µ –ø—Ä–∏–æ–±—Ä–µ—Å—Ç–∏ –ø–æ–¥–ø–∏—Å–∫—É –∏ –ø–æ–ª—É—á–∏—Ç–µ —à–∞–Ω—Å –ø—Ä–∏–Ω—è—Ç—å —É—á–∞—Å—Ç–∏–µ –≤ –ò–ù–¢–ï–†–ê–ö–¢–ò–í–ï!"
    }
	) }}
    {{ STOP }}
{{ END }}


{{ IF true_time < time_now }}

{{ tg_api( deleteMessage = { message_id = message.message_id } ) }}
{{ storage.save('result_' _ user.id,telegram.bot('telegram_bot','/diceup',[user.id])) }}
{{ telegram.bot('telegram_bot','/dice_result',[user.id]) }}

{{ ELSE }}

{{ tg_api( deleteMessage = { message_id = message.message_id } ) }}
{{ TEXT = BLOCK }}
‚õîÔ∏è <b>–í—ã —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ –ø–æ–ø—ã—Ç–∫—É –Ω–∞ —Å–µ–≥–æ–¥–Ω—è.</b>

‚è≥ –í–æ–∑–≤—Ä–∞—â–∞–π—Ç–µ—Å—å —á–µ—Ä–µ–∑: <code>{{ wait_hours }} —á {{ wait_minutes }} –º–∏–Ω</code> üòâ
{{ END #TEXT }}

{{ tg_api( 
    sendMessage = {
        text = TEXT
    }
)}}
{{ END }}

<% CASE [ '/diceup' ] %>
{{ tg_api( 
    sendDice = {
        emoji = üé∞
    }
)}}

<% CASE '/dice_result' %>
{{ dice = storage.read('name','result_' _ user.id ).0.result.dice.value }}

{{ IF dice == 64 }}
  {{ id = user.set_bonus('bonus', 15, 'comment', {'msg' => 'üé∞ –î–∂–µ–∫–ø–æ—Ç!'}) }}
  {{ #TEXT = "üéâ –î–∂–µ–∫–ø–æ—Ç! –í—ã–ø–∞–ª–æ " _ dice _ "\nüí∞ +15 –±–æ–Ω—É—Å–Ω—ã—Ö —Ä—É–±–ª–µ–π!" }}
  {{ TEXT = "üéâ –î–∂–µ–∫–ø–æ—Ç!" }}

{{ ELSE }}
  {{ TEXT = "–£–≤—ã! –ü–æ–≤–µ–∑—ë—Ç –≤ —Å–ª–µ–¥—É—é—â–∏–π —Ä–∞–∑. üòâ" }}

{{ END }}

{{ tg_api(sendMessage = {
    text = TEXT
    parse_mode = "HTML"
}) }}
